#!/bin/bash

if [ "$EUID" -ne 0 ]; then
    echo "This installer must be run as root"
    exit
fi

read -p "Enter your username: " username

# Installing basic packages
xbps-install -Su
xbps-install curl zip unzip xorg lxdm bspwm sxhkd alacritty rofi vim neovim polybar picom feh betterlockscreen lxappearance nodejs firefox dunst Thunar xsel fonts-roboto-ttf starship noto-fonts-emoji

# Nerd fonts
mkdir -p /home/$username/packages/fonts
curl -OL "https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/JetBrainsMono.zip"
unzip JetBrainsMono.zip -d /home/$username/packages/fonts/jetbrainsmono
cp /home/$username/packages/fonts/jetbrainsmono/*.ttf /usr/share/fonts/TTF/

curl -OL 'https://github.com/rsms/inter/releases/download/v3.15/Inter-3.15.zip'
unzip 'Inter-3.15.zip' -d /home/$username/packages/fonts/inter
cp -R /home/$username/packages/fonts/inter /usr/share/fonts/

chown $username:$username -R /home/$username
# JetBrains Mono
runuser -l $username -c '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/install_manual.sh)"'

mkdir -p /home/$username/.config/bspwm
mkdir /home/$username/.config/sxhkd
mkdir /home/$username/.config/alacritty
mkdir /home/$username/.config/nvim
mkdir /home/$username/.config/rofi
mkdir /home/$username/.config/polybar
mkdir /home/$username/.config/picom
mkdir /home/$username/.config/dunst
mkdir -p /home/$username/.local/share/icons
mkdir /home/$username/.themes
mkdir /home/$username/Pictures
mkdir /usr/share/images
mkdir /usr/share/icons/default

cp bspwm/bspwmrc /home/$username/.config/bspwm/bspwmrc
cp sxhkd/sxhkdrc /home/$username/.config/sxhkd/sxhkdrc
cp alacritty/alacritty.yml /home/$username/.config/alacritty/alacritty.yml
cp nvim/* /home/$username/.config/nvim/
cp rofi/config.rasi /home/$username/.config/rofi/config.rasi
cp polybar/* /home/$username/.config/polybar/
cp picom/picom.conf /home/$username/.config/picom/picom.conf

cp F33_wallpaper_dusk.jpg /usr/share/images/

cp -R themes/gtk/Yaru-Blue* /home/$username/.themes/
cp -R themes/gtk/Yaru-Blue* /usr/share/themes/

cp -R themes/icons/Yaru-Blue /home/$username/.local/share/icons/

mkdir /etc/X11/xorg.conf.d
cp X11/* /etc/X11/xorg.conf.d/

chown $username:$username -R /home/$username

runuser -l $username -c "sh -c 'curl -fLo "${XDG_DATA_HOME:-/home/$username/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
       https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'"

echo "session=/usr/bin/bspwm" >> /etc/lxdm/lxdm.conf

echo "[icon theme]" > /usr/share/icons/default/index.theme
echo "Inherits=Adwaita" >> /usr/share/icons/default/index.theme

echo 'eval "$(starship init bash)"' >> /home/$username/.bashrc

ln -s /etc/sv/dbus /var/service/
ln -s /etc/sv/lxdm /var/service/
